#!/usr/bin/perl
die unless($#ARGV==1);
$DAYSAGO = $ARGV[0];
$MINSIZE = $ARGV[1];
chdir('www/plots/sp');
@volcanoes = glob('*');
foreach $volcano (@volcanoes) {
	next unless (-d $volcano); # only get directories,  not colorbar.png
	chdir($volcano);
	print "$volcano: ";
	@years = glob("2*");
	foreach $year (@years) {
		chdir($year);
		@months = glob("[01]*");
		foreach $month (@months) {
			chdir($month);
			@days = glob("[0123]*");
			foreach $day (@days) {
				$epochtime = `epoch "$year/$month/$day" | awk '{print $1}'`;
				$epochnow = `epoch now | awk '{print $1}'`;
				$daysago = ($epochnow - $epochtime) / 86400; 
				next if ($daysago < $DAYSAGO);
				print "Processing $volcano/$year/$month/$day\n";
				chdir($day);
				@files = glob("2*.png");

				$numfiles = $#files + 1;
				$complete=0;
				$validpng = 0;
				foreach $file (@files) {
					$size = -s $file;
					if ($size < $MINSIZE) {
						#print "unlink $file $size\n";
						unlink($file);
						$smallfile = "small_".$file;
						#print "unlink $smallfile\n";
						unlink($smallfile) if (-e $smallfile); 
					}
				}
				chdir("..");
				rmdir($day);
			}
			chdir("..");
			rmdir($month);
		}
		chdir("..");
		rmdir($year);
	}
	chdir("..");
	rmdir($subnet);
	print "\n";
}

	

